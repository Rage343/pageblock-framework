{"version":3,"sources":["../src/abstract-page.js"],"names":[],"mappings":"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","file":"abstract-page.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file abstract-page.js\n * @author Ambroise Maupate\n */\nimport {AbstractBlock} from \"abstract-block.js\";\n\nclass AbstractPage {\n    /**\n     *\n     * @param  {Router}  router\n     * @param  {String}  id\n     * @param  {String}  context\n     * @param  {String}  type\n     * @param  {Boolean} isHome\n     */\n    constructor(router, id, context, type, isHome) {\n        type = type || 'page';\n\n        this.router = router;\n        this.id = id;\n        this.context = context;\n        this.type = type;\n        this.isHome = isHome;\n\n        this.init();\n        this.initEvents();\n    }\n\n    init() {\n        this.loadDurationMin = 1200; // Time for animate loader\n        this.$cont = $('#page-content-'+this.id).eq(0);\n\n        if (this.$cont.length) {\n            this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        } else {\n            this.$link = null;\n        }\n        // Add target blank on external link\n        if(null !== this.$link && this.$link.length){\n            this.externalLinkTarget(this.$link, this.router.baseUrl);\n            this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        }\n\n        // --- Blocks --- //\n        this.blocks = [];\n        this.$block = this.$cont.find('.page-block');\n        this.blockLength = this.$block.length;\n        if(this.blockLength) {\n            this.initBlocks();\n        }\n\n        // --- Context --- //\n        if(this.context == 'static' &&\n           this.router.ajaxEnabled) {\n            this.router.pushFirstState(this.type, this.id, this.isHome);\n        } else if(this.context == 'ajax'){\n            this.initAjax();\n        }\n    }\n\n    destroy() {\n        this.$cont.remove();\n        this.destroyEvents();\n        // --- Blocks --- //\n        if(this.blocks !== null){\n            for(var blockIndex in this.blocks) {\n                this.blocks[blockIndex].destroy();\n            }\n        }\n    }\n\n    initEvents() {\n        if (this.$cont.find('img').length) {\n            this.$cont.waitForImages({\n                finished: $.proxy(this.onLoad, this),\n                waitForAll: true\n            });\n        } else {\n            this.onLoad();\n        }\n\n        if(this.$link !== null && this.router.options.ajaxEnabled) {\n            this.$link.on('click', $.proxy(this.router.linkClick, this.router));\n        }\n\n        $(window).on('resize', debounce($.proxy(this.onResize, this), 100, false));\n    }\n\n    destroyEvents() {\n        if(this.$link !== null && this.router.options.ajaxEnabled) {\n            this.$link.off('click', $.proxy(this.router.linkClick, this.router));\n        }\n\n        $(window).off('resize', debounce($.proxy(this.onResize, this), 100, false));\n    }\n\n    onLoad(e){\n        this.loadDate = new Date();\n        this.loadDuration = this.loadDate - this.router.loadBeginDate;\n\n        var delay = (this.loadDuration > this.loadDurationMin) ? 0 : this.loadDurationMin - this.loadDuration;\n\n        // Hide loading\n        setTimeout(function(){\n            if(this.context == 'static'){\n                // this.show();\n            } else if(this.context == 'ajax'){\n                // Update body id\n                $('body').get(0).id = history.state.nodeName;\n                // Hide formerPages - show\n                if (this.router.formerPages.length > 0) {\n                    var formerPage = this.router.formerPages[(this.router.formerPages.length - 1)],\n                        formerPageDestroy = $.proxy(formerPage.destroy, formerPage);\n\n                    /*\n                     * Very important,\n                     * DO NOT animate if there are more than 1 page\n                     * in destroy queue!\n                     */\n                    if (this.router.formerPages.length > 1) {\n                        formerPageDestroy();\n                    } else {\n                        formerPage.hide(formerPageDestroy);\n                    }\n                    this.router.formerPages.pop();\n                }\n                //console.log(this.router.formerPages);\n                this.show($.proxy(this.showEnded, this));\n            }\n        }, delay);\n    }\n\n    show(onShow){\n        // Animate\n        TweenLite.to(this.$cont, 0.6, {opacity:1, onComplete: f => {\n            this.router.transition = false;\n\n            if (typeof onShow !== 'undefined') {\n                onShow();\n            }\n        }});\n    }\n\n    showEnded() {\n        if(this.context == 'ajax'){\n            removeClass(this.$cont[0], 'page-content-ajax');\n        }\n    }\n\n    hide(onHidden){\n        TweenLite.to(this.$cont, 0.6, {opacity:0, onComplete:onHidden});\n    }\n\n    initAjax() {\n        // --- Change title --- //\n        if(this.$cont.length && this.$cont[0].getAttribute('data-meta-title') !== ''){\n            var metaTitle = this.$cont[0].getAttribute('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    initBlocks() {\n        for(var blockIndex in this.blockLength) {\n            var type = this.$block[blockIndex].getAttribute('data-node-type'),\n                id = this.$block[blockIndex].id;\n\n            if (typeof this.router.routes[type] !== \"undefined\") {\n                this.blocks[blockIndex] = new window[this.router.routes[type]](this, id, type);\n            } else {\n                this.blocks[blockIndex] = new AbstractBlock(this, id, type);\n            }\n        }\n    }\n\n    onResize(){\n\n    }\n\n    /**\n     * Add target blank to external links.\n     *\n     * @param  {[type]} $links\n     * @param  {[type]} baseUrl\n     */\n    externalLinkTarget($links, baseUrl) {\n        var linksLength = $links.length,\n            abstractBaseUrl = baseUrl.split('://');\n\n        abstractBaseUrl = abstractBaseUrl[1];\n\n        for(var linkIndex = 0; linkIndex < linksLength; linkIndex++){\n            var link = $links[linkIndex];\n            if(link.href.indexOf(abstractBaseUrl) == -1 &&\n               link.href.indexOf('javascript') == -1 &&\n               link.href.indexOf('mailto:') == -1 &&\n               link.href.charAt(0) != '/' &&\n               link.href.charAt(0) != '#')\n            {\n                $links[linkIndex].target = '_blank';\n            }\n        }\n    }\n}\n\nexport {AbstractPage};"]}