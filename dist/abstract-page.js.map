{"version":3,"sources":["abstract-page.js"],"names":[],"mappings":"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","file":"abstract-page.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file abstract-page.js\n * @author Ambroise Maupate\n */\nimport TweenLite from \"TweenLite\";\nimport waitForImages from \"waitForImages\";\nimport $ from \"jquery\";\nimport {debounce} from \"utils/debounce\";\nimport {AbstractBlock} from \"abstract-block\";\nimport {Router} from \"router\";\n\nexport class AbstractPage {\n    /**\n     * @param  {Router}  router\n     * @param  {String}  $cont\n     * @param  {String}  context\n     * @param  {String}  type\n     * @param  {Boolean} isHome\n     */\n    constructor(router, $cont, context, type, isHome) {\n        type = type || 'page';\n\n        if (!$cont) {\n            throw \"AbstractPage need a $cont (JQuery) to be defined.\";\n        }\n        if (!router) {\n            throw \"AbstractPage need a Router instance to be defined.\";\n        }\n        if (!(router instanceof Router)) {\n            throw \"'router' must be an instance of Router.\";\n        }\n\n        console.log('New page : ' + type);\n        this.router = router;\n        this.$cont = $cont;\n        this.id = $cont[0].id;\n        this.context = context;\n        this.type = type;\n        this.isHome = isHome;\n        this.onResizeDebounce = debounce(this.onResize.bind(this), 50, false);\n\n        this.init();\n        this.initEvents();\n    }\n\n    init() {\n        this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n\n        // Add target blank on external link\n        if(this.$link.length){\n            this.externalLinkTarget(this.$link, this.router.baseUrl);\n            this.$link = this.$cont.find('a').not('[target=\"_blank\"]');\n        }\n\n        // --- Blocks --- //\n        this.blocks = [];\n        this.$blocks = this.$cont.find(this.router.options.pageBlockClass);\n        this.blockLength = this.$blocks.length;\n        if(this.blockLength) {\n            this.initBlocks();\n        }\n\n        // --- Context --- //\n        if(this.context == 'static' && this.router.ajaxEnabled) {\n            this.router.pushFirstState(this.isHome);\n        } else if(this.context == 'ajax'){\n            this.initAjax();\n        }\n    }\n\n    destroy() {\n        console.log('destroy:' + this.id);\n        this.$cont.remove();\n        this.destroyEvents();\n        // --- Blocks --- //\n        if (this.blocks !== null) {\n            for (var blockIndex in this.blocks) {\n                this.blocks[blockIndex].destroy();\n            }\n        }\n    }\n\n    initEvents() {\n        if (this.$cont.find('img').length) {\n            this.$cont.waitForImages({\n                finished: this.onLoad.bind(this),\n                waitForAll: true\n            });\n        } else {\n            this.onLoad();\n        }\n\n        if(this.$link.length && this.router.options.ajaxEnabled) {\n            this.$link.on('click', this.router.onLinkClick.bind(this.router));\n        }\n\n        window.addEventListener('resize', this.onResizeDebounce);\n    }\n\n    destroyEvents() {\n        this.$link.off('click', this.router.onLinkClick.bind(this.router));\n\n        window.removeEventListener('resize', this.onResizeDebounce);\n    }\n\n    onLoad(e) {\n        this.loadDate = new Date();\n        this.loadDuration = this.loadDate - this.router.loadBeginDate;\n\n        this.router.loader.hide();\n        this.router.nav.update(this.$cont);\n        this.router.nav.initEvents(this.router);\n\n        const delay = (this.loadDuration > this.router.options.minLoadDuration) ? 0 : this.router.options.minLoadDuration - this.loadDuration;\n\n        // Hide loading\n        setTimeout(() => {\n            const onShowEnded = this.showEnded.bind(this);\n\n            if(this.context == 'static'){\n                this.show(onShowEnded);\n            } else if(this.context == 'ajax'){\n                // Update body id\n                $('body').get(0).id = history.state.nodeName;\n                // Hide formerPages - show\n                if (this.router.formerPages.length > 0) {\n                    const formerPage = this.router.formerPages[(this.router.formerPages.length - 1)];\n                    const formerPageDestroy = formerPage.destroy.bind(formerPage);\n\n                    /*\n                     * Very important,\n                     * DO NOT animate if there are more than 1 page\n                     * in destroy queue!\n                     */\n                    if (this.router.formerPages.length > 1) {\n                        formerPageDestroy();\n                    } else {\n                        formerPage.hide(formerPageDestroy);\n                    }\n                    this.router.formerPages.pop();\n                }\n\n                this.show(onShowEnded);\n            }\n        }, delay);\n    }\n\n    show(onShow) {\n        console.log('>>>> Show ----');\n        // Animate\n        var tween = TweenLite.to(this.$cont, 0.6, {'opacity':1, onComplete: () => {\n            this.router.transition = false;\n            if (typeof onShow !== 'undefined') {\n                onShow();\n            }\n        }});\n    }\n\n    showEnded() {\n        console.log('---- Show >>>>');\n        this.router.loader.hide();\n        this.$cont.removeClass(this.router.options.pageClass + '-ajax');\n        this.$cont.removeClass(this.router.options.pageClass + '-transitioning');\n    }\n\n    hide(onHidden) {\n        console.log('hiding:' + this.id);\n        TweenLite.to(this.$cont, 0.6, {opacity:0, onComplete:onHidden});\n    }\n\n    initAjax() {\n        this.$cont.addClass(this.router.options.pageClass + '-transitioning');\n    }\n\n    initBlocks() {\n        this.$blocks.each((blockIndex, block) => {\n            var type = block.getAttribute('data-node-type');\n            var id = block.id;\n            var $block = $(block);\n\n            if (typeof this.router.routes[type] !== \"undefined\") {\n                this.blocks[blockIndex] = new this.router.routes[type](this, $block, type);\n            } else {\n                this.blocks[blockIndex] = new AbstractBlock(this, $block, type);\n            }\n        });\n    }\n\n    onResize(){\n        console.log('resize :' + this.id);\n    }\n\n    /**\n     * Add target blank to external links.\n     *\n     * @param  {JQuery} $links\n     * @param  {String} baseUrl\n     */\n    externalLinkTarget($links, baseUrl) {\n        const linksLength = $links.length;\n        let abstractBaseUrl = baseUrl.split('://');\n\n        abstractBaseUrl = abstractBaseUrl[1];\n\n        for(let linkIndex = 0; linkIndex < linksLength; linkIndex++){\n            const link = $links[linkIndex];\n            console.log(link.href);\n            if(link.href.indexOf(abstractBaseUrl) == -1 &&\n               link.href.indexOf('javascript') == -1 &&\n               link.href.indexOf('mailto:') == -1 &&\n               link.href.charAt(0) != '/' &&\n               link.href.charAt(0) != '#')\n            {\n                $links[linkIndex].target = '_blank';\n            }\n        }\n    }\n}\n"],"sourceRoot":"/source/"}