{"version":3,"sources":["../src/router.js"],"names":[],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport {State} from \"state.js\";\nimport {Home} from \"pages/home.js\";\nimport {AbstractPage} from \"abstract-page.js\";\n\nclass Router {\n    constructor(options, routes, baseUrl) {\n        this.baseUrl = baseUrl;\n        this.routes = routes;\n        this.state = null;\n        this.formerPages = [];\n        this.page = null;\n        this.stateBlock = true;\n        this.ajaxEnabled = true;\n        this.transition = false;\n        this.currentRequest = null;\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            $ajaxContainer: $(\"#ajax-container\"),\n            postLoad: function (state, data) {},\n            preLoad: function (state) {},\n            prePushState: function (state) {},\n            onDestroy: function () {},\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", $.proxy(_this.onPopState, this), false);\n        }\n\n        this.options.onDestroy();\n    }\n\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", $.proxy(_this.onPopState, this), false);\n        }\n    }\n\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && evente.state !== null) {\n            _this.transition = true;\n            _this.loadPage(event, event.state);\n        }\n    }\n\n    boot(nodeType, id, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n\n        if(isHome && _this.options.homeHasClass){\n            this.page = new Home(this, id, context, nodeType, isHome);\n        } else if(nodeType && typeof this.routes[nodeType] !== 'undefined') {\n            this.page = new window[this.routes[nodeType]](this, id, context, nodeType, isHome);\n        } else {\n            this.page = new AbstractPage(this, id, context, nodeType, isHome);\n        }\n    }\n\n    onLinkClick(e) {\n        var linkClassName = e.currentTarget.className,\n            linkHref = e.currentTarget.href;\n\n        if(linkHref.indexOf('mailto:') == -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n               linkClassName.indexOf(this.options.noAjaxLinkClass) == -1 &&\n               !this.transition) {\n\n                this.transition = true;\n\n                var state = new State(e.currentTarget, {\n                    previousType: this.page.type,\n                    navLinkClass: this.options.navLinkClass,\n                });\n                /*\n                 * Hook prePushState method\n                 * to be able to modify state\n                 */\n                this.options.prePushState(state);\n\n                history.pushState(state, state.title, state.href);\n                this.loadPage(e, state);\n            }\n        }\n    }\n\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n\n        this.loadBeginDate = new Date();\n        this.options.preLoad(state);\n\n        this.currentRequest = $.ajax({\n            url: state.href,\n            type: 'get',\n            success: function(data){\n                if(this.url == history.state.href) {\n                    /*\n                     * Display data to DOM\n                     */\n                    this.options.$ajaxContainer.append(data);\n\n                    /*\n                     * Push a copy object not to set it as null.\n                     */\n                    this.formerPages.push(this.page);\n\n                    // Init new page\n                    this.boot(state.nodeType, state.nodeName, 'ajax', state.isHome);\n\n                    this.options.postLoad(state, data);\n\n                    // Analytics\n                    if(typeof ga !== \"undefined\") {\n                        ga('send', 'pageview', {'page':state.href, 'title':document.title});\n                    }\n                }\n            }\n        });\n    }\n}\n\nexport {Router};"]}