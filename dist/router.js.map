{"version":3,"sources":["router.js"],"names":[],"mappings":"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","file":"router.js","sourcesContent":["/**\n * Copyright Â© 2016, Ambroise Maupate\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is furnished\n * to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS\n * IN THE SOFTWARE.\n *\n * @file router.js\n * @author Ambroise Maupate\n */\nimport $ from \"jquery\";\nimport {State} from \"state\";\nimport {Home} from \"pages/home\";\nimport {AbstractPage} from \"abstract-page\";\nimport {GraphicLoader} from \"graphicLoader\";\nimport {Nav} from \"nav\";\n\nexport class Router {\n\n    /**\n     * Create a new Router.\n     *\n     * @param {Object} options\n     * @param {Object} routes\n     * @param {String} baseUrl\n     * @param {GraphicLoader} loader\n     * @param {Nav} nav\n     */\n    constructor(options, routes, baseUrl, loader, nav) {\n        if (!baseUrl) {\n            throw \"Router needs baseUrl to be defined.\";\n        }\n        if (!loader) {\n            throw \"Router needs a GraphicLoader instance to be defined.\";\n        }\n        if (!(loader instanceof GraphicLoader)) {\n            throw \"'loader' must be an instance of GraphicLoader.\";\n        }\n\n        if (!nav) {\n            throw \"Router needs a Nav instance to be defined.\";\n        }\n        if (!(nav instanceof Nav)) {\n            throw \"'nav' must be an instance of Nav.\";\n        }\n\n        this.baseUrl = baseUrl;\n        this.routes = routes;\n        this.loader = loader;\n        this.nav = nav;\n        this.state = null;\n        this.formerPages = [];\n        this.page = null;\n        this.stateBlock = true;\n        this.ajaxEnabled = true;\n        this.transition = false;\n        this.loading = false;\n        this.window = $(window);\n        this.currentRequest = null;\n        this.options = {\n            homeHasClass: false,\n            ajaxEnabled: true,\n            pageClass: \"page-content\",\n            noAjaxLinkClass: \"no-ajax-link\",\n            navLinkClass: \"nav-link\",\n            activeClass: \"active\",\n            pageBlockClass: \".page-block\",\n            $ajaxContainer: $(\"#ajax-container\"),\n            minLoadDuration: 0,\n            postLoad: function (state, data) {},\n            preLoad: function (state) {},\n            prePushState: function (state) {},\n            onDestroy: function () {},\n        };\n\n        if (options !== null) {\n            this.options = $.extend(this.options, options);\n        }\n    }\n\n    destroy() {\n        if (this.options.ajaxEnabled) {\n            window.removeEventListener(\"popstate\", $.proxy(this.onPopState, this), false);\n        }\n\n        this.options.onDestroy();\n    }\n\n    initEvents() {\n        if (this.options.ajaxEnabled) {\n            window.addEventListener(\"popstate\", $.proxy(this.onPopState, this), false);\n        }\n        /*\n         * Init nav events\n         */\n        this.nav.initEvents(this);\n    }\n\n    onPopState(event) {\n        if (typeof event.state !== \"undefined\" && event.state !== null) {\n            this.transition = true;\n            this.loadPage(event, event.state);\n        }\n    }\n\n    /**\n     * Booting need a jQuery handler for\n     * the container.\n     *\n     * @param  {jQuery}  $data\n     * @param  {String}  context\n     * @param  {Boolean} isHome\n     */\n    boot($cont, context, isHome) {\n        if(context == 'static') {\n            this.loadBeginDate = new Date();\n        }\n        var nodeType = $cont.attr('data-node-type');\n\n        if(isHome && this.options.homeHasClass){\n            this.page = new Home(this, $cont, context, nodeType, isHome);\n        } else if(nodeType && typeof this.routes[nodeType] !== 'undefined') {\n            this.page = new this.routes[nodeType](this, $cont, context, nodeType, isHome);\n        } else {\n            console.log('Page (' + nodeType + ') has no defined route, using AbstractPage.');\n            this.page = new AbstractPage(this, $cont, context, nodeType, isHome);\n        }\n    }\n\n    onLinkClick(e) {\n        var linkClassName = e.currentTarget.className,\n            linkHref = e.currentTarget.href;\n\n        if(linkHref.indexOf('mailto:') == -1) {\n            e.preventDefault();\n\n            // Check if link is not active\n            if(linkClassName.indexOf(this.options.activeClass) == -1 &&\n               linkClassName.indexOf(this.options.noAjaxLinkClass) == -1 &&\n               !this.transition) {\n                this.transition = true;\n\n                var state = new State(e.currentTarget, {\n                    previousType: this.page.type,\n                    navLinkClass: this.options.navLinkClass,\n                });\n\n                history.pushState(state, state.title, state.href);\n                this.loadPage(e, state);\n            }\n        }\n    }\n\n    loadPage(e, state) {\n        if(this.currentRequest && this.currentRequest.readyState != 4) {\n            this.currentRequest.abort();\n        }\n        this.loader.show();\n        this.loadBeginDate = new Date();\n\n        var proxiedPreLoad = $.proxy(this.options.preLoad, this);\n        proxiedPreLoad(state);\n\n        var _this = this;\n        this.currentRequest = $.ajax({\n            url: state.href,\n            dataType: \"html\",\n            // Need to disable cache to prevent\n            // browser to serve partial when no\n            // ajax context is defined.\n            cache: false,\n            type: 'get',\n            success: (data) => {\n                // Extract only to new page content\n                // if the whole HTML is queried\n                var $data = null;\n                var $response = $($.parseHTML(data));\n                if ($response.hasClass(_this.options.pageClass)) {\n                    $data = $response;\n                } else {\n                    $data = $response.find('.' + _this.options.pageClass);\n                }\n                /*\n                 * Display data to DOM\n                 */\n                _this.options.$ajaxContainer.append($data);\n\n                /*\n                 * Push a copy object not to set it as null.\n                 */\n                _this.formerPages.push(_this.page);\n\n                // Init new page\n                _this.updatePageTitle($data);\n                _this.boot($data, 'ajax', state.isHome);\n\n                var proxiedPostLoad = $.proxy(_this.options.postLoad, _this);\n                proxiedPostLoad(state, $data);\n\n                // Analytics\n                if(typeof ga !== \"undefined\") {\n                    ga('send', 'pageview', {'page':state.href, 'title':document.title});\n                }\n            }\n        });\n    }\n\n    /**\n     * Update page title against data-title attribute\n     * from ajax loaded partial DOM.\n     *\n     * @param {jQuery} $data\n     */\n    updatePageTitle($data){\n        if($data.length && $data[0].getAttribute('data-meta-title') !== ''){\n            var metaTitle = $data[0].getAttribute('data-meta-title');\n            if(metaTitle !== null && metaTitle !== '') document.title = metaTitle;\n        }\n    }\n\n    pushFirstState(isHome){\n        history.pushState({\n            'firstPage': true,\n            'href':  window.location.href,\n            'isHome':isHome\n        }, null, window.location.href);\n    }\n}\n"],"sourceRoot":"/source/"}